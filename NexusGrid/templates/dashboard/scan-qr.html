{% extends "dashboard/sidebar.html" %}
{% load static %}
{% load compress %}

{% block title %}| QR Code Scanner{% endblock title %}

{% block head %}
{% compress css %}
<link href="{% static 'dashboard/css/dashboard.css' %}" rel="stylesheet">
{% endcompress %}
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
{% endblock head %}

{% block main_content %}
<div class="scanner-page-wrapper">
    <div class="text-center">
        <h1 class="mb-3 animate__animated animate__fadeIn">QR Code Scanner</h1>
        <p class="text-muted mb-4 animate__animated animate__fadeIn animate__delay-1s">
            Align the QR code within the frame to scan
        </p>

        <div class="scanner-container mb-3 animate__animated animate__fadeInUp">
            <div id="reader"></div>
            <div class="overlay">
                <div class="corner top-left"></div>
                <div class="corner top-right"></div>
                <div class="corner bottom-left"></div>
                <div class="corner bottom-right"></div>
            </div>
        </div>

        <!-- Loader after scan -->
        <div class="loader text-center animate__animated animate__fadeIn">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Processing...</span>
            </div>
            <p class="mt-2">Processing scanned data...</p>
        </div>
    </div>
</div>
{% endblock main_content %}

{% block scripts %}
<script>
    // Get the user's role from the body attribute
    var userRole = document.body.getAttribute("data-user-role")?.trim();

    if (userRole) {
        document.querySelectorAll("[data-role]").forEach(el => {
            el.style.display = (el.getAttribute("data-role") === userRole) ? 
                (el.closest(".sidebar") ? "flex" : "block") : "none";
        });
    } else {
        console.warn("User role is missing!");
    }

    initQRScanner()
</script>
{% compress js %}
<script src="{% static 'dashboard/js/dashboard.js' %}"></script>
{% endcompress %}
{% endblock scripts %}